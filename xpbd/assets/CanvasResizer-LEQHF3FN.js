var d=Object.defineProperty;var _=(o,e,t)=>e in o?d(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>(_(o,typeof e!="symbol"?e+"":e,t),t);import{j as f,s as w}from"./vendor-8o0RFIkR.js";const v=o=>{let e=!1;return f(()=>{const t=()=>{requestAnimationFrame(()=>{if(e)return;o()&&t()})};t()}),w(()=>{e=!0}),{}};class c{constructor(e,t=!0,i=!0){r(this,"_canvas");r(this,"_width");r(this,"_height");r(this,"_isDisposed",!1);r(this,"_contentScaleFactor",1);r(this,"_highDefinition",!0);r(this,"_autoResize",!0);this._canvas=e,this._highDefinition=t,this._autoResize=i,this.window_resize=this.window_resize.bind(this),window.addEventListener("resize",this.window_resize,!1),this._autoResize&&this.resize()}get contentScaleFactor(){return this._contentScaleFactor}get highDefinition(){return this._highDefinition}set highDefinition(e){this._highDefinition!==e&&(this._highDefinition=e,this.resize())}get autoResize(){return this._autoResize}set autoResize(e){this._autoResize!==e&&(this._autoResize=e,this.resize())}dispose(){this._isDisposed||(this._isDisposed=!0,window.removeEventListener("resize",this.window_resize,!1))}resize(){let e=this._canvas.parentNode;if(e===null||typeof e>"u")return;let t=this._canvas.style.display;this._canvas.style.display="none";let i=e.clientWidth,l=e.clientHeight,s=1;if(this._highDefinition){let a=c.readViewportScale();if(a!=null){let h=window.devicePixelRatio?window.devicePixelRatio:1;h!=1&&(s=h*a)}}this._contentScaleFactor=s,i*=s,l*=s;let n=!0;if(this._width===i&&this._height===l&&(n=!1),n){this._canvas.width=i,this._canvas.height=l,this._width=i,this._height=l;let a=this._canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(this._contentScaleFactor,this._contentScaleFactor)}this._canvas.style.display=t,n&&this._canvas.dispatchEvent(new Event("resize"))}window_resize(){this._autoResize&&this.resize()}static readViewportScale(){let e=document.querySelectorAll("meta[name=viewport]"),t=null;if(e.length>0&&(t=e[e.length-1]),t===null)return null;let i=t.content;if(i===""||i===null)return null;let l=i.split(",");for(let s=0;s<l.length;++s){let n=l[s];for(;n.indexOf(" ")>=0;)n=n.replace(" ","");let a=n.split("="),h=a[0],u=a[1];if(h==="initial-scale")return Math.round(parseFloat(u)*1e3)/1e3}return null}}export{c as C,v as u};
